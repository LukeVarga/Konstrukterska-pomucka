<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Příručka pro konstruktéry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .component-btn {
            transition: all 0.3s ease;
        }
        .component-btn.active {
            background-color: #1d4ed8; /* blue-700 */
            color: white;
            box-shadow: 0 4px 14px 0 rgba(0, 118, 255, 0.39);
        }
        .detail-card {
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Interaktivní příručka pro konstruktéry</h1>
            <p class="text-md text-gray-600 mt-2">Vyberte si komponentu pro zobrazení technických detailů.</p>
        </header>

        <div id="category-selector" class="flex justify-center flex-wrap gap-3 mb-8"></div>
        <div id="component-selector" class="flex justify-center flex-wrap gap-2 mb-8"></div>

        <div id="component-details" class="w-full max-w-4xl mx-auto">
            <!-- VÝCHOZÍ STAV / NAČÍTÁNÍ -->
            <div id="initial-state" class="text-center p-10 bg-white rounded-xl shadow-md">
                <div class="loader mx-auto"></div>
                <h3 class="mt-4 text-sm font-medium text-gray-900">Načítám data...</h3>
                <p class="mt-1 text-sm text-gray-500">Čekejte prosím, data se načítají z Google Sheets.</p>
            </div>
        </div>
    </div>

    <script>
        // --- Konfigurace ---
        // ZDE VLOŽÍTE ODKAZ NA VAŠI PUBLIKOVANOU GOOGLE TABULKU.
        // V dalším kroku si ukážeme, jak tento odkaz získat.
        const googleSheetUrl = 'SEM_PRIJDE_URL_ADRESA_VASI_TABULKY';

        // --- Globální proměnné ---
        let componentsData = {};
        let activeCategory = null;
        let activeComponentId = null;

        const categorySelector = document.getElementById('category-selector');
        const componentSelector = document.getElementById('component-selector');
        const componentDetails = document.getElementById('component-details');
        const initialStateDiv = document.getElementById('initial-state');

        /**
         * Funkce pro načtení a zpracování dat z Google Sheets.
         */
        async function fetchAndProcessData() {
            // Zkontrolujeme, zda je URL adresa vyplněna. Pokud ne, zobrazíme výzvu.
            if (googleSheetUrl === 'SEM_PRIJDE_URL_ADRESA_VASI_TABULKY') {
                initialStateDiv.innerHTML = `
                    <h3 class="text-xl font-bold text-orange-600">Konfigurace chybí</h3>
                    <p class="mt-2 text-gray-600">V kódu aplikace je potřeba nastavit URL adresu vaší Google Tabulky.</p>
                    <p class="mt-1 text-sm text-gray-500">Otevřete HTML soubor v editoru a do proměnné <strong>googleSheetUrl</strong> vložte odkaz na publikovanou tabulku.</p>
                `;
                return;
            }

            try {
                const response = await fetch(googleSheetUrl);
                if (!response.ok) {
                    throw new Error(`Chyba při načítání dat: ${response.statusText}`);
                }
                const csvText = await response.text();
                parseCsvToData(csvText);
                initializeApp();
            } catch (error) {
                console.error('Nepodařilo se načíst data z Google Sheets:', error);
                initialStateDiv.innerHTML = `
                    <h3 class="text-xl font-bold text-red-600">Chyba</h3>
                    <p class="mt-2 text-gray-600">Nepodařilo se načíst data z Google Sheets.</p>
                    <p class="mt-1 text-sm text-gray-500">Zkontrolujte prosím URL adresu a ujistěte se, že je tabulka správně publikována a má veřejný přístup.</p>
                `;
            }
        }

        /**
         * Funkce převede text ve formátu CSV na datovou strukturu, se kterou aplikace pracuje.
         */
        function parseCsvToData(csvText) {
            const rows = csvText.trim().split(/\r?\n/).map(row => row.split(',').map(cell => cell.trim()));
            if (rows.length < 2) {
                componentsData = {};
                return;
            }
            const headers = rows[0];
            const dataRows = rows.slice(1);
            
            const paramHeaders = headers.slice(5);
            const data = {};

            dataRows.forEach(row => {
                const category = row[0];
                if (!category) return; 

                if (!data[category]) {
                    data[category] = [];
                }

                const component = {
                    id: row[1],
                    name: row[2],
                    image: row[3],
                    description: row[4],
                    params: {}
                };

                paramHeaders.forEach((header, index) => {
                    const value = row[index + 5];
                    if (header && value) {
                        component.params[header] = value;
                    }
                });

                data[category].push(component);
            });
            
            componentsData = data;
        }

        /**
         * Inicializuje aplikaci po načtení dat.
         */
        function initializeApp() {
            if (Object.keys(componentsData).length === 0) {
                 initialStateDiv.innerHTML = `
                    <h3 class="text-xl font-bold text-blue-600">Žádná data</h3>
                    <p class="mt-2 text-gray-600">Aplikace je úspěšně připojena, ale v tabulce zatím nejsou žádná data.</p>
                    <p class="mt-1 text-sm text-gray-500">Přidejte řádky do vaší Google Tabulky a obnovte tuto stránku.</p>
                `;
                initialStateDiv.style.display = 'block';
            } else {
                initialStateDiv.style.display = 'none';
                renderCategoryButtons();
            }
        }

        // --- Zobrazovací funkce ---

        function showComponentDetails(category, componentId) {
            const component = componentsData[category].find(c => c.id === componentId);
            if (!component) return;

            let paramsHtml = '';
            for (const [key, value] of Object.entries(component.params)) {
                paramsHtml += `
                    <tr class="border-b border-gray-200 last:border-b-0">
                        <td class="py-3 px-4 text-sm font-medium text-gray-600">${key}</td>
                        <td class="py-3 px-4 text-sm text-gray-800 font-semibold">${value}</td>
                    </tr>`;
            }

            componentDetails.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden detail-card">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
                        <div class="p-4 bg-gray-50 flex items-center justify-center">
                            <img src="${component.image}" alt="Technický výkres ${component.name}" class="max-w-full h-auto rounded-lg object-contain" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e0e0/757575?text=Obr%C3%A1zek+nenalezen';">
                        </div>
                        <div class="p-6">
                            <h2 class="text-2xl font-bold text-blue-700 mb-2">${component.name}</h2>
                            <p class="text-gray-600 mb-6">${component.description}</p>
                            <div class="overflow-x-auto rounded-lg border border-gray-200">
                                <table class="w-full text-left"><tbody class="bg-white">${paramsHtml}</tbody></table>
                            </div>
                        </div>
                    </div>
                </div>`;
            activeComponentId = componentId;
            renderComponentButtons();
        }

        function renderComponentButtons() {
            if (!activeCategory) return;
            componentSelector.innerHTML = '';
            const components = componentsData[activeCategory];
            if (!components) return;
            
            components.forEach(component => {
                const button = document.createElement('button');
                button.textContent = component.name;
                const isActive = component.id === activeComponentId;
                button.className = `component-btn px-4 py-2 text-sm font-medium rounded-md shadow-sm border ${isActive ? 'active' : 'bg-white text-gray-700 hover:bg-gray-50'}`;
                button.onclick = () => showComponentDetails(activeCategory, component.id);
                componentSelector.appendChild(button);
            });
        }
        
        function selectCategory(categoryName) {
            activeCategory = categoryName;
            activeComponentId = null;
            componentDetails.innerHTML = '';
            initialStateDiv.style.display = 'block';
            initialStateDiv.innerHTML = `
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">Vyberte díl</h3>
                <p class="mt-1 text-sm text-gray-500">Nyní si vyberte konkrétní díl z kategorie "${categoryName}".</p>
            `;
            renderCategoryButtons();
            renderComponentButtons();
        }

        function renderCategoryButtons() {
            categorySelector.innerHTML = '';
            Object.keys(componentsData).forEach(categoryName => {
                const button = document.createElement('button');
                button.textContent = categoryName;
                const isActive = categoryName === activeCategory;
                button.className = `component-btn px-5 py-2.5 text-base font-semibold rounded-lg shadow-md border ${isActive ? 'active' : 'bg-white text-blue-600 border-blue-600 hover:bg-blue-50'}`;
                button.onclick = () => selectCategory(categoryName);
                categorySelector.appendChild(button);
            });
        }

        // --- Spuštění aplikace ---
        window.onload = fetchAndProcessData;

    </script>
</body>
</html>
