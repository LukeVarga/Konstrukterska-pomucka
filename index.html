<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Příručka pro konstruktéry</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .component-btn {
            transition: all 0.3s ease;
        }
        .component-btn.active {
            background-color: #1d4ed8; /* blue-700 */
            color: white;
            box-shadow: 0 4px 14px 0 rgba(0, 118, 255, 0.39);
        }
        .variation-btn {
            transition: all 0.2s ease;
        }
        .variation-btn.active {
            background-color: #2563eb; /* blue-600 */
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .detail-card {
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Interaktivní příručka pro konstruktéry</h1>
            <p class="text-md text-gray-600 mt-2">Vyberte si komponentu pro zobrazení technických detailů.</p>
        </header>

        <div id="category-selector" class="flex justify-center flex-wrap gap-3 mb-8"></div>
        <div id="component-selector" class="w-full max-w-4xl mx-auto text-center mb-8"></div>

        <div id="component-details" class="w-full max-w-4xl mx-auto">
            <!-- VÝCHOZÍ STAV / NAČÍTÁNÍ -->
            <div id="initial-state" class="text-center p-10 bg-white rounded-xl shadow-md">
                <div class="loader mx-auto"></div>
                <h3 class="mt-4 text-sm font-medium text-gray-900">Načítám data...</h3>
                <p class="mt-1 text-sm text-gray-500">Čekejte prosím, data se načítají ze souborů.</p>
            </div>
        </div>
    </div>

    <script>
        // --- Konfigurace ---
        const categories = {
            "Lisovací šrouby": {
                file: "data - Lisovací šrouby.csv",
                icon: "Lisovací šroub ikona.png"
            },
            "Lisovací matice": {
                file: "data - Lisovací matice.csv",
                icon: "Lisovací matice ikona.png"
            },
            "Lisovací sloupky uzavřené": {
                file: "data - Lisovací sloupky uzavřené.csv",
                icon: "Lisovací sloupek uzavřený ikona.png"
            },
            "Lisovací sloupky průchozí": {
                file: "data - Lisovací sloupky průchozí.csv",
                icon: "Lisovací sloupek průchozí ikona.png"
            }
        };
        const imageBasePath = 'images/';

        // --- Globální proměnné ---
        let componentsData = {};
        let activeCategory = null;
        let activeComponentName = null;

        const categorySelector = document.getElementById('category-selector');
        const componentSelector = document.getElementById('component-selector');
        const componentDetails = document.getElementById('component-details');
        const initialStateDiv = document.getElementById('initial-state');

        /**
         * Načte a zpracuje data z více CSV souborů.
         */
        async function fetchAndProcessData() {
            const fetchPromises = Object.entries(categories).map(async ([categoryName, categoryData]) => {
                try {
                    const response = await fetch(categoryData.file);
                    if (!response.ok) throw new Error(`Soubor ${categoryData.file} nebyl nalezen (stav: ${response.status})`);
                    const csvText = await response.text();
                    parseCsvForCategory(csvText, categoryName);
                    return { status: 'fulfilled', category: categoryName };
                } catch (error) {
                    console.error(`Chyba při načítání souboru pro kategorii '${categoryName}':`, error);
                    return { status: 'rejected', category: categoryName, reason: error.message };
                }
            });

            const results = await Promise.all(fetchPromises);
            if (results.every(r => r.status === 'rejected')) {
                 initialStateDiv.innerHTML = `<div class="bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg"><h3 class="text-xl font-bold">Chyba při načítání dat</h3><p class="mt-2">Aplikaci se nepodařilo načíst žádný z datových souborů.</p></div>`;
            } else {
                initializeApp();
            }
        }

        /**
         * Převede text ve formátu CSV na datovou strukturu.
         */
        function parseCsvForCategory(csvText, categoryName) {
            const lines = csvText.trim().split(/\r?\n/);
            if (lines.length < 2) return;
            
            const parseCsvRow = (rowText) => {
                const result = [];
                let currentField = '';
                let inQuotes = false;
                for (const char of rowText) {
                    if (char === '"' && (inQuotes || currentField.length === 0)) {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(currentField.trim());
                        currentField = '';
                    } else {
                        currentField += char;
                    }
                }
                result.push(currentField.trim());
                return result.map(field => field.replace(/^"|"$/g, '').trim());
            };

            const headers = parseCsvRow(lines[0]);
            const dataRows = lines.slice(1);
            
            if (!componentsData[categoryName]) componentsData[categoryName] = {};

            const nameIndex = headers.indexOf('Name');
            const imageIndex = headers.indexOf('Image');
            const descriptionIndex = headers.indexOf('Description');
            const idIndex = headers.indexOf('ID');

            if (nameIndex === -1 || imageIndex === -1 || descriptionIndex === -1) {
                console.error(`Chyba ve struktuře souboru pro '${categoryName}'. Chybí jeden ze sloupců: 'Name', 'Image', 'Description'.`);
                return;
            }

            dataRows.forEach((rowText, rowIndex) => {
                if (!rowText) return;
                const row = parseCsvRow(rowText);
                const componentName = row[nameIndex];
                if (!componentName) return;

                if (!componentsData[categoryName][componentName]) {
                    componentsData[categoryName][componentName] = {
                        image: row[imageIndex],
                        description: row[descriptionIndex],
                        variations: []
                    };
                }
                
                const id = idIndex !== -1 && row[idIndex] ? row[idIndex] : `${categoryName}-${componentName}-${rowIndex}`;
                const variation = { id: id, params: {} };
                headers.forEach((header, index) => {
                    if (row[index]) variation.params[header] = row[index];
                });
                componentsData[categoryName][componentName].variations.push(variation);
            });
        }

        /**
         * Inicializuje aplikaci po načtení dat.
         */
        function initializeApp() {
            initialStateDiv.style.display = 'none';
            renderCategoryButtons();
        }

        /**
         * Zobrazí detail komponenty.
         */
        function showComponentDetails(category, componentName, selectedVariationId = null) {
            const componentGroup = componentsData[category]?.[componentName];
            if (!componentGroup) return;

            activeComponentName = componentName;
            const activeVariationId = selectedVariationId || componentGroup.variations[0].id;
            const activeVariation = componentGroup.variations.find(v => v.id === activeVariationId);

            const variationsHtml = componentGroup.variations.map(variation => {
                const length = variation.params['L±0,4'] || variation.id;
                const isActive = variation.id === activeVariationId;
                return `<button onclick="showComponentDetails('${category}', '${componentName}', '${variation.id}')" class="variation-btn px-3 py-1.5 text-sm font-medium rounded-md shadow-sm border ${isActive ? 'active' : 'bg-white text-gray-700 hover:bg-gray-50'}">${length}</button>`;
            }).join('');

            const paramsHtml = Object.entries(activeVariation.params).map(([key, value]) => {
                 if (['Name', 'Image', 'Description', 'ID'].includes(key)) return ''; 
                return `<tr class="border-b border-gray-200 last:border-b-0"><td class="py-3 px-4 text-sm font-medium text-gray-600">${key}</td><td class="py-3 px-4 text-sm text-gray-800 font-semibold">${value}</td></tr>`;
            }).join('');

            const imageUrl = `${imageBasePath}${componentGroup.image}`;
            componentDetails.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden detail-card">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
                        <div class="p-4 bg-gray-50 flex items-center justify-center"><img src="${imageUrl}" alt="Výkres ${componentName}" class="max-w-full h-auto rounded-lg object-contain" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e0e0e0/757575?text=Obr%C3%A1zek+nenalezen';"></div>
                        <div class="p-6">
                            <h2 class="text-2xl font-bold text-blue-700 mb-2">${componentName}</h2>
                            <p class="text-gray-600 mb-4">${componentGroup.description}</p>
                            <div class="mb-6">
                                <h4 class="text-sm font-bold text-gray-500 mb-2">Dostupné varianty (Délka L):</h4>
                                <div class="flex flex-wrap gap-2">${variationsHtml}</div>
                            </div>
                            <div class="overflow-x-auto rounded-lg border border-gray-200">
                                <table class="w-full text-left"><tbody class="bg-white">${paramsHtml}</tbody></table>
                            </div>
                        </div>
                    </div>
                </div>`;
            initialStateDiv.style.display = 'none';
            renderComponentButtons();
        }

        /**
         * Vykreslí ikonu (pokud je třeba) a tlačítka pro výběr komponent.
         */
        function renderComponentButtons() {
            componentSelector.innerHTML = '';
            if (!activeCategory || !componentsData[activeCategory]) return;
            
            if (!activeComponentName) {
                const categoryIcon = categories[activeCategory]?.icon;
                if (categoryIcon) {
                    componentSelector.innerHTML += `<img src="${imageBasePath}${categoryIcon}" alt="Ikona ${activeCategory}" class="h-16 mx-auto mb-4 transition-opacity duration-300" onerror="this.style.display='none'">`;
                }
            }
            
            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'flex justify-center flex-wrap gap-2';
            const components = Object.keys(componentsData[activeCategory]);
            buttonContainer.innerHTML = components.map(name => {
                const isActive = name === activeComponentName;
                return `<button class="component-btn px-4 py-2 text-sm font-medium rounded-md shadow-sm border ${isActive ? 'active' : 'bg-white text-gray-700 hover:bg-gray-50'}" onclick="showComponentDetails('${activeCategory}', '${name}')">${name}</button>`;
            }).join('');
            componentSelector.appendChild(buttonContainer);
        }
        
        /**
         * Zvolí aktivní kategorii a připraví zobrazení.
         */
        function selectCategory(categoryName) {
            activeCategory = categoryName;
            activeComponentName = null; 
            componentDetails.innerHTML = '';
            initialStateDiv.style.display = 'block';
            initialStateDiv.innerHTML = `<svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2z" /></svg><h3 class="mt-2 text-sm font-medium text-gray-900">Vyberte díl</h3><p class="mt-1 text-sm text-gray-500">Nyní si vyberte konkrétní díl z kategorie "${categoryName}".</p>`;
            renderCategoryButtons();
            renderComponentButtons(); 
        }

        /**
         * Vykreslí tlačítka pro výběr kategorií.
         */
        function renderCategoryButtons() {
            categorySelector.innerHTML = Object.keys(categories).map(categoryName => {
                if (!componentsData[categoryName] || Object.keys(componentsData[categoryName]).length === 0) return '';
                const isActive = categoryName === activeCategory;
                return `<button class="component-btn px-5 py-2.5 text-base font-semibold rounded-lg shadow-md border ${isActive ? 'active' : 'bg-white text-blue-600 border-blue-600 hover:bg-blue-50'}" onclick="selectCategory('${categoryName}')">${categoryName}</button>`;
            }).join('');
        }

        // --- Spuštění aplikace ---
        window.onload = fetchAndProcessData;
    </script>
</body>
</html>
